TARGET := pycorn
OBJECTS = main.o getpath.o frozen.o $(EXTMODULES) $(ROOT)/libs/python/libpython2.5.a
SYSLIBS := -lm
RAMDISK := initrd.zip

include seed.mk
include $(ROOT)/libs/python/python.mk

ifdef DEBUG_PYSTARTUP
CFLAGS += -DDEBUG_PYSTARTUP
endif

FREEZEDIRS += frozen

$(phony always):

ifndef USE_BINARIES
stamp-version: always
	bzr version-info --custom --template "{date} {revno} {revision_id} {branch_nick}" > stamp-version

frozen/bootstrap/version.py: stamp-version : signature md5
	bzr version-info --python > $(output)

frozen.c: $( $(FREEZEDIRS))/**/*.py $(ROOT)/libs/python/stamp-frozen freeze.py
	$(PYTHON) freeze.py $(output) $(FREEZEDIRS) $(ROOT)/libs/python/frozen
endif

initrd.zip: $( $(INITRDDIRS))/** $(ROOT)/libs/python/stamp-initrd makezip.py
	$(PYTHON) makezip.py $(output) $(INITRDDIRS) $(ROOT)/libs/python/initrd

ifdef USE_BINARIES
pycorn.uimage: $(MACHPATH)/$(MACH)-pycorn.uimage
	&cp -f $(input) $(output)
endif
