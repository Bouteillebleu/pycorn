PYTHONVER := 2.5.2
PYTHONVERMINOR := 2.5

libpython$(PYTHONVERMINOR).a: stamp-target
	cp -p targetpy/$(output) $(output)

FREEZEMODS := $(&cat freezelist)

stamp-frozen: stamp-sources
	rm -rf frozen
	&mkdir frozen
	cp -p Python-$(PYTHONVER)/Lib/$(FREEZEMODS) frozen
	&touch stamp-frozen

stamp-include: stamp-target stamp-sources
	rm -rf include
	&mkdir include
	cp -p Python-$(PYTHONVER)/Include/*.h include
	cp -p targetpy/pyconfig.h include
	&touch stamp-include

stamp-target: stamp-sources hostpgen $(LDDEPS)
	rm -rf targetpy
	&mkdir targetpy
	cd targetpy; MACHDEP=pycorn CFLAGS="$(LDFLAGS)" ../Python-$(PYTHONVER)/configure --host=arm-eabi --without-signal-module
	cd targetpy; make HOSTPGEN=$(CURDIR)/hostpgen EXTRA_CFLAGS="$(PYCFLAGS)" libpython$(PYTHONVERMINOR).a
	&touch stamp-target

hostpgen: stamp-host
	cp -p hostpy/Parser/pgen $(output)

stamp-host: stamp-sources
	rm -rf hostpy 
	&mkdir hostpy
	cd hostpy; ../Python-$(PYTHONVER)/configure
	cd hostpy; make Parser/pgen
	&touch stamp-host

stamp-quilt: $(ROOT)/downloads/Python-$(PYTHONVER).tar.bz2
	rm -rf quilt
	&mkdir quilt
	cd quilt; tar jxf ../$(input)
	&ln -s ../../patches quilt/Python-$(PYTHONVER)
	cd quilt/Python-$(PYTHONVER); quilt push -a
	&touch $(output)

stamp-sources Python-$(PYTHONVER)/configure: $(ROOT)/downloads/Python-$(PYTHONVER).tar.bz2 patches/*
	rm -rf Python-$(PYTHONVER)
	tar jxf $(input)
	cd Python-$(PYTHONVER); for p in `cat ../patches/series`; do patch -p1 < ../patches/$$p; done
	cd Python-$(PYTHONVER); autoconf
	&touch $(output)

no_implicit_load Python-$(PYTHONVER) hostpy targetpy

include common.mk
