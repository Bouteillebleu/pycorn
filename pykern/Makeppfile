OBJECTS = main.o getpath.o frozen.o $(EXTMODULES) $(ROOT)/python/libpython2.5.a
SYSLIBS := -lm
RAMDISK := initrd.zip

$(phony all): pykern.flash

include python/pyinclude.mk
include common.mk

ifdef DEBUG_PYSTARTUP
CFLAGS += -DDEBUG_PYSTARTUP
endif

FREEZEDIRS += frozen

$(phony always):

stamp-version: always
	bzr version-info --custom --template "{date} {revno} {revision_id} {branch_nick}" > stamp-version

frozen/bootstrap/version.py: stamp-version : signature md5
	bzr version-info --python > $(output)

frozen.c: $( $(FREEZEDIRS))/**/*.py $(ROOT)/python/stamp-frozen freeze.py
	python freeze.py $(output) $(FREEZEDIRS) $(ROOT)/python/frozen

initrd.zip: $( $(INITRDDIRS))/** $(ROOT)/python/stamp-initrd makezip.py
	python makezip.py $(output) $(INITRDDIRS) $(ROOT)/python/initrd
